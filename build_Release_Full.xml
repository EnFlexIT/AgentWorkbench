<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     project:		Agent.GUI
     description	Builds a release consisting of executable and API	
     ====================================================================== -->
<project name="AgentGui" default="buildReleaseFull" basedir=".">
	
	<!-- Folder information for compiling and packing the AgentGui.jar -->
	<property name="srcAPI" value="doc\api\\" />
	
	<property name="destDir" value="exec\AgentGUI\\" />
	<property name="destJar" value="${destDir}\AgentGui.jar" />		
	<property name="destDirAPI" value="${destDir}\doc\api\\" />
	<property name="destDirLibraries" value="${destDir}\lib\\" />
	<property name="destDirProperties" value="${destDir}\properties\\" />
	<property name="destDirProjects" value="${destDir}\projects\\" />

	<property name="destDirReleaseFile" value="exec\\" />
	
	<!-- Version - Information -->
	<property name="versionPropertyFile" value="src\agentgui\version.properties"/>
	<property name="versionBuildNumberFile" value="src\agentgui\build.number"/>
	
	<property prefix="old" file="${versionPropertyFile}"/>
	<property name="version.major" value="${old.version.major}"/>
	<property name="version.minor" value="${old.version.minor}"/>
			
	<property file="${versionBuildNumberFile}"/>
	<property name="version.build" value="${build.number}"/>
			
	<property name="zip.javadoc" value="Agent.GUI_${version.major}.${version.minor}_API.zip"/>
	<property name="zip.release" value="Agent.GUI_${version.major}.${version.minor}_${version.build}.zip"/>
	
    
	<!-- target: buildRelease => Create a full Release File -->
	<target name="buildReleaseFull" depends="" description="Building Full Release ${doc.title} ... ">
		
		<echo>Building Release: ${version.major}.${version.minor} - ${version.build}</echo>
		<antcall target="buildExec"/> 
		<antcall target="buildJavaDoc"/>
		<antcall target="packReleaseFull"/>
		<echo>Build Release: ${version.major}.${version.minor} - ${version.build}</echo>
		
	</target>

	<!-- target: buildRelease => Create a Release, just with the executabel part -->
	<target name="buildReleaseExec" depends="" description="Building Exec Release ${doc.title} ... ">
		
		<echo>Building Release: ${version.major}.${version.minor} - ${version.build}</echo>
		<antcall target="buildExec"/> 
		<antcall target="buildJavaDoc"/>
		<antcall target="packReleaseExec"/>
		<echo>Build Release: ${version.major}.${version.minor} - ${version.build}</echo>
		
	</target>

	
	
	<target name="buildExec" depends="" description="Building Release ${doc.title} ... ">
		<ant antfile="build_Executable.xml" target="buildOnly"/>			
	</target>
	
	<target name="buildJavaDoc" depends="" description="Building Release ${doc.title} ... ">
		<ant antfile="build_JavaDoc.xml"/>	
		<delete failonerror="false" dir="${destDirAPI}" />
		<copy file="${srcAPI}\${zip.javadoc}" tofile="${destDirAPI}\${zip.javadoc}"/>
	</target>
	
	<target name="packReleaseFull" depends="" description="Building Release ${doc.title} ... ">
		<delete failonerror="false" file="${destDirReleaseFile}/${zip.release}" />
		<zip destfile="${destDirReleaseFile}/${zip.release}" basedir="${destDir}">
			<exclude name="/projects/**" />
			<exclude name="/server/**" />
			<exclude name="/download/**" />
			<exclude name="**/agentgui.ini"/>
			<exclude name="AgentGUINode.bin"/>
			<exclude name="MTPs-**.txt"/>
			<exclude name="APDescription.txt"/>
		</zip>	
	</target>
	
	<target name="packReleaseExec" depends="" description="Building Release ${doc.title} ... ">
		<delete failonerror="false" file="${destDirReleaseFile}/${zip.release}" />
		<zip destfile="${destDirReleaseFile}/${zip.release}" basedir="${destDir}">
			<exclude name="/lib/**" />
			<exclude name="/projects/**" />
			<exclude name="/server/**" />
			<exclude name="/download/**" />
			<exclude name="**/agentgui.ini"/>
			<exclude name="AgentGUINode.bin"/>
			<exclude name="MTPs-**.txt"/>
			<exclude name="APDescription.txt"/>
		</zip>	
	</target>
	
</project>
